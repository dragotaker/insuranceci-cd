# Документация по маршрутам (routes.py)

## Общее описание
Модуль `routes.py` содержит все маршруты и обработчики запросов веб-приложения. Реализует CRUD операции, поиск, валидацию данных и обработку ошибок.

## Основные маршруты

### 1. Статические файлы
```python
@route('/static/<filename:path>')
def serve_static(filename):
    return static_file(filename, root='static')
```
- Обслуживает статические файлы (CSS, JS, изображения)
- Использует встроенный механизм Bottle для раздачи файлов

### 2. Главная страница
```python
@route('/')
def index():
    return template('templates/layout.tpl', 
                    title='Главная',
                    current_page='home',
                    base=template('templates/index.tpl'))
```
- Отображает главную страницу
- Использует базовый шаблон с навигацией

### 3. Просмотр таблицы
```python
@route('/table/<table_name>')
def show_table(table_name):
```
#### Особенности:
1. **Поиск**:
   - Поддержка поиска по всем полям таблицы
   - Возможность выбора конкретного поля для поиска
   - Обработка UTF-8 кодировки для кириллицы
   - Использование ILIKE для регистронезависимого поиска

2. **Отображение данных**:
   - Динамическое формирование SQL-запроса
   - Исключение полей паролей из выборки
   - Поддержка связей между таблицами
   - Форматирование данных для отображения

3. **Безопасность**:
   - Проверка существования таблицы
   - Экранирование SQL-запросов
   - Валидация входных данных

### 4. Добавление записи
```python
@route('/add/<table_name>', method=['GET', 'POST'])
def add_record(table_name):
```
#### Особенности:
1. **Обработка форм**:
   - Поддержка GET и POST методов
   - Валидация обязательных полей
   - Обработка специальных типов данных
   - Поддержка внешних ключей

2. **Создание пользователей**:
   - Автоматическое создание пользователей для клиентов/сотрудников
   - Хеширование паролей
   - Назначение ролей

3. **Обработка ошибок**:
   - Откат транзакций при ошибках
   - Отображение сообщений об ошибках
   - Валидация уникальных полей

### 5. Редактирование записи
```python
@route('/edit/<table_name>/<id_value>', method=['GET', 'POST'])
def edit_record(table_name, id_value):
```
#### Особенности:
1. **Загрузка данных**:
   - Получение текущих значений
   - Поддержка всех типов полей
   - Загрузка связанных данных

2. **Обновление**:
   - Частичное обновление полей
   - Обработка NULL значений
   - Обновление связанных записей

3. **Валидация**:
   - Проверка существования записи
   - Валидация новых значений
   - Проверка прав доступа

### 6. Удаление записи
```python
@route('/delete/<table_name>/<id_value>')
def delete_record(table_name, id_value):
```
#### Особенности:
1. **Проверки**:
   - Проверка существования записи
   - Проверка связей с другими таблицами
   - Обработка ошибок триггеров

2. **Безопасность**:
   - Проверка прав доступа
   - Защита от каскадного удаления
   - Логирование операций

### 7. Статистические отчеты
```python
@route('/reports')
def show_reports():
```
#### Особенности:
1. **Сбор данных**:
   - Выполнение сложных SQL-запросов
   - Агрегация данных
   - Форматирование результатов

2. **Отображение**:
   - Использование шаблонов
   - Форматирование чисел
   - Обработка ошибок

## Вспомогательные функции

### 1. Получение данных для внешних ключей
```python
def get_foreign_data(table_name, table_config):
```
- Загрузка данных для выпадающих списков
- Кэширование результатов
- Форматирование для отображения

### 2. Обработка ошибок
- Логирование ошибок
- Форматирование сообщений
- Отображение пользователю

## Безопасность

### 1. Защита от SQL-инъекций
- Использование параметризованных запросов
- Экранирование специальных символов
- Валидация входных данных

### 2. Управление доступом
- Проверка ролей пользователей
- Ограничение доступа к функциям
- Логирование действий

### 3. Обработка данных
- Валидация форм
- Санитизация входных данных
- Защита от XSS

## Оптимизация

### 1. Кэширование
- Кэширование часто используемых данных
- Оптимизация запросов
- Минимизация обращений к БД

### 2. Производительность
- Оптимизация SQL-запросов
- Индексация таблиц
- Пакетная обработка

## Анимации и интерактивность

### 1. Формы
- Валидация на стороне клиента
- Анимации при отправке
- Индикация загрузки

### 2. Таблицы
- Сортировка
- Фильтрация
- Пагинация

### 3. Поиск
- Автодополнение
- Подсветка результатов
- Анимация результатов 